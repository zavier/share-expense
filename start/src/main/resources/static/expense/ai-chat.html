<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI 记账助手</title>
    <!-- 本地资源，无需网络 -->
    <script src="/expense/lib/marked.min.js"></script>
    <link rel="stylesheet" href="/expense/ai-chat.css">
</head>
<body>
    <!-- Background Shapes -->
    <div class="bg-shapes">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
        <div class="shape shape-3"></div>
    </div>

    <div class="container" id="chatContainer" style="display: none;">
        <!-- Sidebar Overlay for mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <span class="sidebar-title">对话历史</span>
            </div>
            <button class="new-chat-btn" onclick="createNewSession()">
                <span>+</span>
                <span>新建对话</span>
            </button>
            <div class="session-list" id="sessionList">
                <!-- Sessions will be loaded here -->
            </div>
        </div>

        <!-- Main Chat Area -->
        <div class="main-area">
            <!-- Header -->
            <div class="header">
                <button class="menu-btn" id="menuBtn" onclick="toggleSidebar()">☰</button>
                <div class="avatar-ring">
                    <div class="avatar">✨</div>
                </div>
                <div class="header-content">
                    <div class="header-title">AI 记账助手</div>
                    <div class="header-subtitle">我可以帮你管理账单、记录支出、计算分摊</div>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar-small">👤</div>
                    <span class="user-name" id="userName"></span>
                    <button class="logout-btn" onclick="logout()" title="退出登录">🚪</button>
                </div>
                <div class="status-badge">
                    <span class="status-dot"></span>
                    <span>在线</span>
                </div>
            </div>

            <!-- Chat Container -->
            <div class="chat-wrapper">
                <div class="messages-area" id="messagesArea">
                    <!-- Welcome Screen -->
                    <div class="welcome-screen" id="welcomeScreen">
                        <div class="welcome-avatar">✨</div>
                        <h2>嗨！我是你的 AI 记账助手</h2>
                        <p>我可以帮你管理账单、记录支出、计算分摊</p>
                        <div class="suggestions">
                            <div class="suggestion-card" onclick="sendSuggestion('创建项目「周末聚餐」，成员有小明、小红、小李')">
                                <div class="suggestion-icon">📋</div>
                                <div class="suggestion-card-content">
                                    <h4>创建项目</h4>
                                    <p>创建新的费用分摊项目</p>
                                </div>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('今天午饭张三付了80元，我们四个人平摊')">
                                <div class="suggestion-icon">💳</div>
                                <div class="suggestion-card-content">
                                    <h4>记录费用</h4>
                                    <p>快速记录一笔支出</p>
                                </div>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('给「周末聚餐」项目添加成员：小王')">
                                <div class="suggestion-icon">👥</div>
                                <div class="suggestion-card-content">
                                    <h4>添加成员</h4>
                                    <p>向项目添加新成员</p>
                                </div>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('查询「周末聚餐」的结算情况')">
                                <div class="suggestion-icon">📊</div>
                                <div class="suggestion-card-content">
                                    <h4>查询结算</h4>
                                    <p>查看费用分摊情况</p>
                                </div>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('查看我的所有项目')">
                                <div class="suggestion-icon">📁</div>
                                <div class="suggestion-card-content">
                                    <h4>项目列表</h4>
                                    <p>查看所有费用项目</p>
                                </div>
                            </div>
                            <div class="suggestion-card" onclick="sendSuggestion('查看「周末聚餐」的费用明细')">
                                <div class="suggestion-icon">📊</div>
                                <div class="suggestion-card-content">
                                    <h4>费用明细</h4>
                                    <p>查看项目费用详细分析</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="input-area">
                    <div class="quick-chips" id="quickChips">
                        <button class="chip" onclick="sendSuggestion('创建项目「周末聚餐」，成员有小明、小红')">创建项目</button>
                        <button class="chip" onclick="sendSuggestion('今天午饭AA，80元4个人分')">记录费用</button>
                        <button class="chip" onclick="sendSuggestion('查询「周末聚餐」结算')">查询结算</button>
                        <button class="chip" onclick="sendSuggestion('查看「周末聚餐」的费用明细')">费用明细</button>
                        <button class="chip" onclick="sendSuggestion('查看我的项目')">项目列表</button>
                    </div>
                    <div class="input-container">
                        <div class="input-wrapper">
                            <textarea class="input-field" id="messageInput" placeholder="输入消息...（Enter 发送，Shift+Enter 换行）" rows="1"></textarea>
                        </div>
                        <button class="send-button" id="sendBtn" onclick="sendMessage()">➤</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- Auth View (Login/Register) -->
    <div class="auth-view" id="authView">
        <div class="auth-card">
            <div class="auth-header">
                <div class="auth-icon">✨</div>
                <h2 class="auth-title" id="authTitle">登录</h2>
                <p class="auth-subtitle" id="authSubtitle">登录以使用 AI 记账助手</p>
            </div>

            <div class="auth-error" id="authError"></div>

            <!-- Login Form -->
            <form class="auth-form" id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label class="form-label">用户名</label>
                    <input type="text" class="form-input" id="loginUsername" placeholder="请输入用户名" required>
                </div>
                <div class="form-group">
                    <label class="form-label">密码</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="请输入密码" required>
                </div>
                <button type="submit" class="form-button" id="loginBtn">登录</button>
                <div class="auth-switch">
                    没有账号？<span class="auth-link" onclick="showRegisterForm()">点击注册</span>
                </div>
            </form>

            <!-- Register Form -->
            <form class="auth-form" id="registerForm" style="display: none;" onsubmit="handleRegister(event)">
                <div class="form-group">
                    <label class="form-label">用户名</label>
                    <input type="text" class="form-input" id="regUsername" placeholder="请输入用户名" required>
                </div>
                <div class="form-group">
                    <label class="form-label">邮箱</label>
                    <input type="email" class="form-input" id="regEmail" placeholder="请输入邮箱" required>
                </div>
                <div class="form-group">
                    <label class="form-label">密码</label>
                    <input type="password" class="form-input" id="regPassword" placeholder="请输入密码（至少6位）" minlength="6" required>
                </div>
                <div class="form-group">
                    <label class="form-label">确认密码</label>
                    <input type="password" class="form-input" id="regConfirmPassword" placeholder="请再次输入密码" minlength="6" required>
                </div>
                <button type="submit" class="form-button" id="registerBtn">注册</button>
                <div class="auth-switch">
                    已有账号？<span class="auth-link" onclick="showLoginForm()">点击登录</span>
                </div>
            </form>
        </div>
    </div>

    <script src="/expense/ai-chat.js"></script>
</body>
</html>
